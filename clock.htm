<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ™‚è¨ˆãƒ»å¤©æ°—ãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º</title>

<style>
/* ===== å…¨ä½“ ===== */
body {
  margin: 0;
  font-family: "Segoe UI","Hiragino Sans","Meiryo",sans-serif;
  background: #000;
  color: #fff;
  padding-top: 180px;
}

/* ===== ä¸Šéƒ¨ãƒãƒ¼ ===== */
#top-bar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 260px;
  display: flex;
  gap: 20px;
  padding: 15px 20px;
  box-sizing: border-box;
  background: #000;
  z-index: 100;
}

/* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ===== */
#calendar-container {
  flex: 0 0 25%;
  background: #000;
  border-radius: 12px;
  padding: 10px;
  box-shadow: inset 0 0 15px rgba(255,255,255,0.1);
  overflow: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  text-align: center;
}

th {
  background: #111;
  padding: 4px;
  font-weight: normal;
}

td {
  padding: 6px;
  border: 1px solid #333;
}

td.today {
  background: #d32f2f;
  font-weight: bold;
}

/* ===== å¤©æ°— ===== */
#weather {
  flex: 0 0 380px;
  display: flex;
  align-items: center;
  gap: 10px;
  background: rgba(0,0,0,0.6);
  padding: 10px;
  border-radius: 10px;
  box-shadow: inset 0 0 10px rgba(255,255,255,0.1);
  margin-top: -10px;
}

#weather img {
  width: 128px;
  height: 128px;
}

#weather-now {
  font-size: 3em;
  font-weight: bold;
}

#weather-desc {
  font-size: 1.5em;
  color: #ccc;
}
  
#weather-range {
  font-size: 1.5em;
  color: #ccc;
}
#weather-night {
  font-size: 1.5em;
  color: #ccc;
}
/* ===== ã‚¢ãƒŠãƒ­ã‚°æ™‚è¨ˆ ===== */
.clock {
  width: 128px;
  height: 128px;
  border-radius: 50%;
  background: radial-gradient(circle, #111 60%, #000 100%);
  border: 4px solid #222;
  position: relative;
  box-shadow:
    inset 0 0 10px rgba(255,255,255,0.1),
    0 0 15px rgba(0,0,0,0.8);
  transform: scale(1.5, 1.5);
  transform-origin: center;
  margin-top: 30px;
  margin-right: 0px;
}

/* ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ */
.clock span {
  position: absolute;
  width: 100%;
  height: 100%;
  transform: rotate(calc(30deg * var(--i)));
}
.clock span::before {
  content: "";
  position: absolute;
  top: 8px;
  left: 50%;
  width: 2px;
  height: 10px;
  background: #ddd;
  transform: translateX(-50%);
}

/* é‡ */
.hand {
  position: absolute;
  bottom: 50%;
  left: 50%;
  transform-origin: bottom;
  transform: translateX(-50%);
}

.hour   { width: 3px;   height: 30px; background: #fff; }
.minute { width: 2px;   height: 42px; background: #ccc; }
.second { width: 1.5px; height: 38px; background: #d32f2f; }

/* ç§’é‡å…ˆç«¯ï¼ˆç¸¦ã«æ‰å¹³ãªæ¥•å††ï¼‰ */
.second::after {
  content: "";
  position: absolute;
  top: -6px;
  left: 50%;
  width: 16px;
  height: 16px;
  background: #d32f2f;
  border-radius: 50%;
  transform: translateX(-50%) scale(1,1);
}

/* ä¸­å¤® */
.center {
  position: absolute;
  width: 6px;
  height: 6px;
  background: #fff;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

/* ===== ãƒ‡ã‚¸ã‚¿ãƒ«ï¼ˆå·¦ä¸‹ï¼‰ ===== */
#digital {
  position: fixed;
  left: 30px;
  bottom: 20px;
  font-family: monospace;
}

#digital-time {
  font-size: 23em;
  font-weight: bold;
}

#digital-date {
  font-size: 1em;
  color: #ccc;
}
</style>
</head>

<body>

<!-- ä¸Šéƒ¨ãƒãƒ¼ -->
<div id="top-bar">
  <div id="calendar-container"></div>

<div id="weather">
  <img id="weather-icon" alt="weather">
  <div>
    <div id="weather-now"></div>
    <div id="weather-range"></div>
    <div id="weather-desc"></div>
    <hr>
    <div id="weather-night"></div>
  </div>
</div>

  <div class="clock">
    <div class="hand hour" id="hour"></div>
    <div class="hand minute" id="minute"></div>
    <div class="hand second" id="second"></div>
    <div class="center"></div>

    <span style="--i:1"></span><span style="--i:2"></span><span style="--i:3"></span>
    <span style="--i:4"></span><span style="--i:5"></span><span style="--i:6"></span>
    <span style="--i:7"></span><span style="--i:8"></span><span style="--i:9"></span>
    <span style="--i:10"></span><span style="--i:11"></span><span style="--i:12"></span>
  </div>
</div>

<!-- ãƒ‡ã‚¸ã‚¿ãƒ« -->
<div id="digital">
  <div id="digital-time"></div>
  <div id="digital-date"></div>
</div>

<script>
/* ===== ã‚¢ãƒŠãƒ­ã‚°æ™‚è¨ˆï¼ˆ+10åˆ†ï¼‰ ===== */
function updateAnalogClock() {
  const now = new Date();
  const plus10 = new Date(now.getTime() + 10 * 60 * 1000);

  const sec = plus10.getSeconds();
  const min = plus10.getMinutes();
  const hour = plus10.getHours();

  document.getElementById("second").style.transform =
    `translateX(-50%) rotate(${sec * 6}deg)`;
  document.getElementById("minute").style.transform =
    `translateX(-50%) rotate(${min * 6 + sec * 0.1}deg)`;
  document.getElementById("hour").style.transform =
    `translateX(-50%) rotate(${hour * 30 + min * 0.5}deg)`;
}
setInterval(updateAnalogClock, 1000);
updateAnalogClock();

/* ===== ãƒ‡ã‚¸ã‚¿ãƒ«æ™‚è¨ˆï¼ˆ+10åˆ† / ç§’ãªã— / ä¸­å›½èªæ—¥ä»˜ï¼‰ ===== */
function updateDigitalClock() {
  const now = new Date();
  const plus10 = new Date(now.getTime() + 10 * 60 * 1000);

  document.getElementById("digital-time").textContent =
    plus10.toLocaleTimeString('ja-JP', {
      hour12: false,
      hour: '2-digit',
      minute: '2-digit'
    });

/* document.getElementById("digital-date").textContent =
    plus10.toLocaleDateString('zh-CN', {
      year: '2-digit',
      month: '2-digit',
      day: '2-digit',
      weekday: 'short'
    }); */
}
setInterval(updateDigitalClock, 1000);
updateDigitalClock();

/* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ===== */
function generateCalendar(y, m) {
  const c = document.getElementById("calendar-container");
  c.innerHTML = "";

  const h = document.createElement("h3");
  h.textContent = `${String(y).slice(-2)}å¹´ ${m}æœˆ`;
  //c.appendChild(h);

  const t = document.createElement("table");
  const days = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
  let r = document.createElement("tr");

  days.forEach(d => {
    const th = document.createElement("th");
    th.textContent = d;
    r.appendChild(th);
  });
  t.appendChild(r);

  const fd = new Date(y, m - 1, 1).getDay();
  const ld = new Date(y, m, 0).getDate();
  r = document.createElement("tr");

  for (let i = 0; i < fd; i++) r.appendChild(document.createElement("td"));

  for (let d = 1; d <= ld; d++) {
    const td = document.createElement("td");
    td.textContent = d;

    const today = new Date();
    if (d === today.getDate() &&
        m === today.getMonth() + 1 &&
        y === today.getFullYear()) {
      td.classList.add("today");
    }

    r.appendChild(td);
    if ((fd + d) % 7 === 0) {
      t.appendChild(r);
      r = document.createElement("tr");
    }
  }
  t.appendChild(r);
  c.appendChild(t);
}

const now = new Date();
generateCalendar(now.getFullYear(), now.getMonth() + 1);

/* ===== å¤©æ°—ï¼ˆæ±äº¬ï¼‰ ===== */
async function loadTokyoWeather() {
  const API_KEY = "579376d4a1533024ba302c945c6555d6";

  const currentURL =
    `https://api.openweathermap.org/data/2.5/weather` +
    `?q=Tokyo,jp&units=metric&lang=ja&appid=${API_KEY}`;

  const forecastURL =
    `https://api.openweathermap.org/data/2.5/forecast` +
    `?q=Tokyo,jp&units=metric&lang=ja&appid=${API_KEY}`;

 try {
    /* ===== ç¾åœ¨ã®å¤©æ°— ===== */
    const currentRes = await fetch(currentURL);
    const current = await currentRes.json();

    const nowTemp = Math.round(current.main.temp);
    const nowDesc = current.weather[0].description;
    const nowIcon = current.weather[0].icon;

    document.getElementById("weather-now").innerHTML =
      `${nowTemp}<small>â„ƒ</small>`;

    document.getElementById("weather-desc").textContent = nowDesc;

    document.getElementById("weather-icon").src =
      `https://openweathermap.org/img/wn/${nowIcon}@2x.png`;

    /* ===== äºˆå ±ï¼ˆä»Šæ—¥ã®æœ€ä½ãƒ»æœ€é«˜ ï¼‹ æ·±å¤œï¼‰ ===== */
    const forecastRes = await fetch(forecastURL);
    const forecast = await forecastRes.json();

    const now = new Date();
    const todayY = now.getFullYear();
    const todayM = now.getMonth();
    const todayD = now.getDate();

    let todayMin = Infinity;
    let todayMax = -Infinity;

    // ä»Šæ—¥ã®0æ™‚
    const targetMidnight = new Date(now);
    if (now.getHours() >= 12) {
      targetMidnight.setDate(todayD + 1);
    }
    targetMidnight.setHours(0, 0, 0, 0);

    let closestNight = null;
    let minDiff = Infinity;

    forecast.list.forEach(item => {
      const t = new Date(item.dt * 1000);

      // âœ… ä»Šæ—¥åˆ†ã®æœ€ä½ãƒ»æœ€é«˜
      if (
        t.getFullYear() === todayY &&
        t.getMonth() === todayM &&
        t.getDate() === todayD
      ) {
        todayMin = Math.min(todayMin, item.main.temp_min);
        todayMax = Math.max(todayMax, item.main.temp_max);
      }

      // âœ… æ·±å¤œï¼ˆ0æ™‚å‰å¾Œï¼‰
      const diff = Math.abs(t - targetMidnight);
      if (diff < minDiff) {
        minDiff = diff;
        closestNight = item;
      }
    });

    // ä»Šæ—¥ã®æœ€ä½ãƒ»æœ€é«˜ã‚’è¡¨ç¤º
   const range = await getTodayTemperatureRange();
    document.getElementById("weather-range").innerHTML =
      `${range.max}<small>â„ƒ</small> / ${range.min}<small>â„ƒ</small>`;

    // æ·±å¤œã®å¤©æ°—ãƒ»æ°—æ¸©
    if (closestNight) {
      const nightTemp = Math.round(closestNight.main.temp);
      const nightDesc = closestNight.weather[0].description;

      document.getElementById("weather-night").innerHTML =
        `ğŸŒ™ ${nightTemp}<small>â„ƒ</small> / ${nightDesc}`;
    }

  } catch (e) {
    document.getElementById("weather-desc").textContent =
      "å¤©æ°—å–å¾—å¤±æ•—";
  }
}

  async function getTodayTemperatureRange() {
  const API_KEY = "579376d4a1533024ba302c945c6555d6";
  const url =
    `https://api.openweathermap.org/data/2.5/forecast` +
    `?q=Tokyo,jp&units=metric&lang=ja&appid=${API_KEY}`;

  const now = new Date();
  const todayKey = `${now.getFullYear()}${now.getMonth()}${now.getDate()}`;

  // ğŸ” ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª
  const saved = localStorage.getItem("weatherToday");
  if (saved) {
    const data = JSON.parse(saved);
    if (data.key === todayKey) {
      // âœ… ä»Šæ—¥åˆ†ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚Œã°å†åˆ©ç”¨
      console.log("âœ” ä»Šæ—¥ã®æ°—æ¸©ãƒ‡ãƒ¼ã‚¿ã‚’å†åˆ©ç”¨");
      return data.range;
    }
  }

  // 6æ™‚å‰ã¯å‰æ—¥ã®ãƒ‡ãƒ¼ã‚¿å†åˆ©ç”¨ã«ã™ã‚‹
  if (now.getHours() < 6 && saved) {
    const data = JSON.parse(saved);
    console.log("ğŸŒ… 6æ™‚å‰ã®ãŸã‚å‰æ—¥ãƒ‡ãƒ¼ã‚¿å†åˆ©ç”¨");
    return data.range;
  }

  // âœ… æ–°è¦å–å¾—
  console.log("ğŸŒ¤ æ°—æ¸©ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­â€¦");
  const res = await fetch(url);
  const data = await res.json();

  const todayY = now.getFullYear();
  const todayM = now.getMonth();
  const todayD = now.getDate();

  let todayMin = Infinity;
  let todayMax = -Infinity;

  data.list.forEach(item => {
    const t = new Date(item.dt * 1000);
    // å½“æ—¥ï¼ˆ0ã€œ23æ™‚ï¼‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
    if (
      t.getFullYear() === todayY &&
      t.getMonth() === todayM &&
      t.getDate() === todayD
    ) {
      todayMin = Math.min(todayMin, item.main.temp_min);
      todayMax = Math.max(todayMax, item.main.temp_max);
    }
  });

  const range = {
    min: Math.round(todayMin),
    max: Math.round(todayMax)
  };

  // âœ… ä¿å­˜ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿æŒï¼‰
  localStorage.setItem(
    "weatherToday",
    JSON.stringify({ key: todayKey, range })
  );

  return range;
}
  
loadTokyoWeather();
setInterval(loadTokyoWeather, 30 * 60 * 1000);
setInterval(() => location.reload(), 60 * 60 * 1000);
</script>

</body>
</html>



























